<div class='row-fluid'>
    <div class='col-md-12'>
        <div class='pull-right'>
            <div class="btn-group">
                <a href="{{=URL('curso', 'add_inscriptos', args=curso)}}" class="btn btn-xs btn-default">Inscribir Nuevo</a>
                <a href="{{=URL('curso', 'import_inscriptos', args=curso)}}" class="btn btn-xs btn-default">Importar</a>
            </div>
        </div>
    </div>
</div>

<div class='row-fluid'>
    <div class='col-md-12'>
        {{if inscriptos:}}
            <div class='table-responsive' style="margin-top:10px;">
                <table id='curso-inscriptos' class="table table-striped table-bordered" cellspacing="0">
                    <thead>
                        <tr>
                            <th>Inscripto</th>
                            <th>Matricula</th>
                            <th>Documento</th>
                            <th>Domicilio</th>
                            <th><span class='glyphicon glyphicon-usd' title='Abon칩?'></span></th>
                            <th><span class='glyphicon glyphicon glyphicon-list-alt' title='Se acredit칩?'></span></th>
                            <th></th>
                        </tr>
                    </thead>

                    <tbody>
                        {{for row in inscriptos:}}
                            <tr data-object='inscripto-{{=row.id}}'>
                                <td>{{=A(label_inscripto(row),
                                        _href=URL(c='persona',
                                                  f='index',
                                                  args=('view', 'persona', row.persona),
                                                  user_signature=True),
                                        _class='link-person',
                                        )
                                    }}
                                </td>
                                <td>{{=row.persona.matricula or 'sin matricula'}}</td>
                                <td>{{=row.persona.dni or '-'}}</td>
                                <td>{{=row.persona.domicilio or '-'}}</td>
                                <td class='abonar'>
                                    {{if row.pago:}}
                                        <center class='alert-success'><span class='glyphicon glyphicon-ok'></span></center>
                                    {{else:}}
                                        <center class='alert-danger'><span class='glyphicon glyphicon-remove'></span></center>
                                    {{pass}}
                                </td>
                                <td class='acreditar'>
                                    {{if row.acreditado:}}
                                        <center class='alert-success'><span class='glyphicon glyphicon-ok'></span></center>
                                    {{else:}}
                                        <center class='alert-danger'><span class='glyphicon glyphicon-remove'></span></center>
                                    {{pass}}
                                </td>   
                                <td>
                                    <div class='btn-group'>
                                        <a class='btn btn-default btn-xs actions {{="disabled" if row.pago else ""}}' title='Abonar' data-title="Realizar Pago" data-action="abonar">
                                            <span class='glyphicon glyphicon-usd'></span>
                                        </a>
                                        <a class='btn btn-default btn-xs actions {{="disabled" if row.acreditado else ""}}' title='Asistio' data-title="Confirma Asistencia?" data-action='acreditar'>
                                            <span class='glyphicon glyphicon glyphicon-list-alt'></span>
                                        </a>
                                        <a id="btn-certificado" class='btn btn-default btn-xs' title='Imprimir Certificado'>
                                            <span class='glyphicon glyphicon-print'></span>
                                        </a>
                                        <a class='btn btn-danger btn-xs remove-item' data-db='false' title='Eliminar'>
                                            <span class='glyphicon glyphicon-remove-sign'></span>
                                        </a>  
                                </td> 
                            </tr>
                        {{pass}}
                    </tbody>
                </table>
            </div>
        {{pass}}
    </div>
</div>

<div class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3><span id='titulo'></span></h3>
            </div>
            <div class="modal-body">
                <div id='contenido'>Contenido</div>
            </div>
            <div class="modal-footer">
                <span class='btn-ok'></span>
                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">Cancelar</button>
            </div>
        </div>
    </div>
</div>


<script>
    $('#curso-inscriptos').dataTable({
        oLanguage: {sUrl: "{{=URL('static', 'media/translate/dataTables.spanish.txt')}}"}
    });
    $(document).on('click', '.actions',
        function(event) {
            Button = $(event.currentTarget);
            person_name = Button.parents('tr').find('.link-person').text();
            ok = '<a class="btn btn-primary" onclick="{ajax}">{name}</a>';

            if (Button.data('action') == 'abonar'){
                ax = "ajax('{URL}', ['monto', 'nro_recibo'], ':eval');"
                content = 'Est치 por realizar el pago de ' + person_name;
                content += '<hr><div class="form-horizontal> \
                                <div class="form-group"> \
                                    <label class="form-label">Monto $</label> \
                                    <input class="form-control" type="number" name="monto" > \
                                </div> \
                                <div class="form-group"> \
                                    <label class="form-label">Nro Recibo</label>\
                                    <input class="form-control" type="text" name="nro_recibo"> \
                                </div> \
                            </div>';

                ok = ok.replace('{name}', Button.data('action'));
                ax = ax.replace('{URL}', '{{=URL(c="inscripto", f="actions", args=("abonar", "data-object"), user_signature=True)}}');
                ax = ax.replace('data-object', Button.parents('tr').data('object'));
                ok = ok.replace('{ajax}', ax);
                
            }

            else if (Button.data('action') == 'acreditar'){
                ax = "ajax('{URL}', [], ':eval');"
                content = 'Est치 por acreditar a ' + person_name;
                ok = ok.replace('{name}', Button.data('action'));
                ax = ax.replace('{URL}', '{{=URL(c="inscripto", f="actions", args=("acreditar", "data-object"), user_signature=True)}}');
                ax = ax.replace('data-object', Button.parents('tr').data('object'));
                ok = ok.replace('{ajax}', ax);
            }

            $('.modal').find('#titulo').html(Button.data('title'));
            $('.modal').find('#contenido').html(content);
            $('.modal').find('.btn-ok').html(ok);
            $('.modal').modal('show');
        }
    );
</script>